/*! "1.216.0-20230427-082846-39155b8" */!function(){"use strict";const e="log",t="warn",o={enabled:!1};("undefined"!=typeof window&&/[?|&]ads-debug/.test(window.location.href)||"undefined"!=typeof document&&-1!==document.cookie.indexOf("ads-debug="))&&(o.enabled=!0);const n=function(t){return(n,a=e)=>{o.enabled&&console[a](`dotcom:${t} ${n}`)}},a=e=>{const t=e?e.replace(/(_|-|\/)[0-9]{7,8}$/,"").replace(/\/articles\/c[0-9a-hj-np-z]{10,}o$/,"/articles"):"";return t.indexOf("/")>-1?t.split("/"):[t]},s=e=>{if("undefined"==typeof document||!e)return"";const t=`; ${document.cookie}`.split(`; ${encodeURIComponent(e)}=`);let o="";return 2===t.length&&(o=decodeURIComponent(t.pop().split(";").shift())),o},i=(e,t,o)=>{if("undefined"==typeof document||!e)return;const n=new Date(Date.now()+864e5*o);document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; expires=${n.toGMTString()}; domain=.bbc.com; path=/`},r=e=>{window.dotcom.consent=e},c=["AT","AX","BE","BG","BL","CY","CZ","DE","DK","EE","ES","EU","FI","FR","GB","GF","GG","GI","GP","GR","HR","HU","IE","IM","IS","IT","JE","LI","LT","LU","LV","MF","MT","MQ","NL","NO","PL","PM","PT","RE","RO","SE","SI","SK","YT"],d=()=>"undefined"!=typeof window&&/[?|&]ads-debug/.test(window.location.href),w=()=>"undefined"!=typeof live&&"test"===live||-1!==window.location.href.indexOf("test.api.bbc.co.uk")||/(localhost|sandbox|int|test)(.dev)*.bbc.co*/.test(window.location.href),l=()=>!0===window.dotcom.userinfo.notUkIp&&!0===window.dotcom.userinfo.ads,p=()=>d()||l()&&window.dotcom.flags.state>0&&window.dotcom.flags.adverts,u=e=>{var t;window.dotcom.userinfo.country=e["X-Country"],window.dotcom.userinfo.notUkIp="no"===e["X-Ip_is_uk_combined"],window.dotcom.userinfo.ads="yes"===e["X-Ip_is_advertise_combined"],!0===window.dotcom.userinfo.notUkIp&&(window.dotcom.userinfo.eea=!!(t=window.dotcom.userinfo.country)&&-1!==c.indexOf(t.toUpperCase()))},m=(e,t)=>{t||(delete e.adverts,delete e.analytics),Object.keys(e).forEach((t=>{let o=e[t];o="true"===o||o,o="false"!==o&&o,window.dotcom.flags[t]=o})),"www.bbc.com"!==window.location.hostname||"/news/uk/the_queen"!==window.location.pathname&&"/news/live/uk-62902778"!==window.location.pathname||(window.dotcom.flags.adverts=!1)},g=async(e,t)=>fetch(e).then((e=>{if(e.ok)return e.json();throw new Error(t)})),f=async()=>{const e="Error fetching flags",t=await g(w()?"https://gn-flagpoles.test.api.bbci.co.uk/ngas":"https://gn-flagpoles.api.bbci.co.uk/ngas",e).catch((()=>{throw window.dotcom.flags.state=-2,new Error(e)}));m(t,!1),window.dotcom.flags.state=2};let h=[];const b={isAdsDebug:d,isTestEnv:w,isStageEnv:()=>/stage.bbc.co*/.test(window.location.href),isSignedIn:()=>s("ckns_id"),isDotcomAllowed:l,syncAdsEnabled:()=>p(),isAdsEnabled:()=>new Promise((e=>{window.dotcom.userinfo.state<0||window.dotcom.flags.state<0?e(p()):0===window.dotcom.userinfo.state||0===window.dotcom.flags.state?h.push(e):e(p())})),checkCookies(){r(1);const e=s("ckns_policy");(d()||e&&"1"===e.charAt(2))&&r(2),e||window.dotcom.userinfo.eea||(r(2),i("ckns_policy","111",365),i("ckns_explicit","0",365))},async init(){const e=new URLSearchParams(window.location.search);try{d()?(window.dotcom.userinfo.notUkIp=!0,window.dotcom.userinfo.ads=!0,window.dotcom.flags.adverts=!0,window.dotcom.flags.analytics=!0,window.dotcom.userinfo.state=1,await f()):(await(async()=>{const e="Error fetching userinfo",{userinfo:t={}}=window.dotcom.config;if(t["X-Country"]&&t["X-Ip_is_uk_combined"]&&t["X-Ip_is_advertise_combined"])return u(t),void(window.dotcom.userinfo.state=2);const o=await g("https://www.bbc.com/userinfo",e).catch((()=>{throw window.dotcom.userinfo.state=-1,new Error(e)}));u(o),window.dotcom.userinfo.state=1})(),l()?window.dotcom.config.opsFlags&&!e.has("force-client-flagpoles")?(m(window.dotcom.config.opsFlags,!0),m(window.dotcom.config.ngasFlags,!1),window.dotcom.flags.state=2):(await(async()=>{const e="Error fetching gnlops flags",t=await g(w()?"https://gn-flagpoles.test.api.bbci.co.uk/gnlops":"https://gn-flagpoles.api.bbci.co.uk/gnlops",e).catch((()=>{throw window.dotcom.flags.state=-1,new Error(e)}));m(t,!0),window.dotcom.flags.state=1})(),!0!==window.dotcom.flags.adverts&&!0!==window.dotcom.flags.analytics||await f()):window.dotcom.flags.state=-3)}finally{h&&h.length>0&&(h.forEach((e=>e(p()))),h=[])}},reset(){h=[]}},_=()=>window.dotcom.data,y=e=>(e=>_().urlParams.has(e))(e)?_().urlParams.get(e):"",v=()=>window.dotcom.data,x=new RegExp("^(/)?(afaanoromoo|afrique|amharic|arabic|azeri|bengali|burmese|gahuza|gujarati|hausa|hindi|igbo|indonesia|korean|kyrgyz|japanese|marathi|mundo|naidheachdan|nepali|pashto|persian|pidgin|portuguese|punjabi|russian|serbian|sinhala|somali|swahili|tajik|tamil|telugu|thai|tigrinya|turkce|ukchina|ukrainian|urdu|uzbek|vietnamese|yoruba|zhongwen)"),S=new RegExp("^/ws/av-embeds/"),k=()=>{const e=v().channel;return"future"===e||"worklife"===e||"travel"===e||"culture"===e},E=e=>{const t=e||window.location.pathname;return x.test(t)||S.test(t)},I=k,T=()=>"storyworks"===v().channel,$=["/4817","/bbccom.ENV.site.SITE","/SECTION_SUBSECTION"];let O="";let U;const A=(e,t)=>{if(O)return O;const o=[...$],n=e.split("?")[0],s=/web.(int|test|stage).bbcx.test.api.bbc.com/.test(window.location.href)?"test":"",i=U||y("site")||s;U=i;const r=y("adUnit");let c=n.match(/http(|s):\/\/[a-z0-9\-.]+(.com|.co.uk)(:\d+)?(\/)?(.*)?/);c=c?c.pop():"",c=c&&""!==c?(e=>e.replace(/^(news\/av\/)(.*)\/[^/]+$/,"$1$2").replace(/^news\/av\//,"news/").replace(/_and_/,"-").replace(/^news\/uk-(england|northern-ireland|scotland|wales)($|-|\/)/,"news/uk/$2").replace(/^news\/uk-([a-z]+)(-([a-z]+))?/,"news/$1/$3").replace(/^news\/(world)-([a-z-]+)/,"news/$2/").replace(/^sport\/av\//,"sport/").replace(/^sport\/(world|uk)/,"sport").replace(/^sport\/(.*)\/sports($|\/)/,"sport/$1$2").replace(/market-data\/overview/,"market-data").replace(/^(programmes)/,"news/$1"))(c):c;const d=a(c)||[],w=E(c),l=b.isTestEnv(n);let p=""===d[0]||"wwhp"===d[0]?"www":d[0];return r||(void 0===d[0]&&(d[0]="homepage"),"sport"!==d[0]&&"weather"!==d[0]||(p="news",d[1]&&(d[1]=d[1].replace("-",""))),"in-pictures"===d[1]&&(d[1]="inpictures"),"news"===d[0]&&d[1]&&d[1].indexOf("-")>0&&("index"===(e=>{const t={AV:"media_asset",INDEX:"index",FIX:"index",STY:"story"};let o;const n=window?.SIMORGH_DATA?.pageData?.metadata?.type;return void 0===o&&n&&(o=t[n]),void 0===o&&(o=/[0-9]{7,8}$/.test(e)?"story":"index",(e.includes("/articles/")||e.includes("/article/"))&&(o="story")),/\/(sport|news)\/live\//.test(e)&&(o="live_event"),o})(window.location.pathname)?d[1]=d[1].replace("-",""):d[1]=d[1].split("-")[0]),"test"===i&&(p="flash"),"preview"===i&&(p="test"),"russian"!==d[0]||l||"preview"===i||"test"===i||(p="russia"),"zhongwen"!==d[0]&&"ukchina"!==d[0]||l||(p=d[0]+d[1]),o[1]=""!==i?o[1].replace("ENV",i):o[1].replace("ENV",l?"test":"live"),w&&(!l&&"preview"!==i&&"test"!==i||"live"===i)&&(o[1]=o[1].replace("/bbccom.","/bbcworldservice.")),o[1]=w||!t||l||"test"===i||"preview"===i?o[1].replace("SITE",p).replace("japanese","japan"):o[1].replace("SITE",`mobile.${p}`),"zhongwen"===d[0]?(o[2]=o[2].replace("SECTION",d[0]+d[1]),o[2]=o[2].replace("SUBSECTION",void 0!==d[2]?`${d[2]}_content`:"home_content")):"reel"===d[0]?(o[2]=o[2].replace("SECTION",d[0]),o[2]=o[2].replace("SUBSECTION",void 0!==d[1]?"other":"homepage")):(o[2]=o[2].replace("SECTION",""===d[0]||"wwhp"===d[0]?"bbc":d[0]),o[2]=o[2].replace("SUBSECTION",void 0!==d[1]?`${d[1]}_content`:"homepage_int").replace("articles_","")),o.join(""))};let C=[];const j=n("permutive"),R=()=>{j("get cust_params");const e=window.localStorage.getItem("_pdfps");return encodeURIComponent(JSON.parse(e||"[]").slice(0,250).join(","))},N=(()=>{let e;const t=function(e,t,o){return e.concat("%26",t,"%3D",o)};return{parseIASResponseData:function(t){e=JSON.parse(t)},getIASPageTargetingAsQueryString:function(){let o="";return o=t(o,"fr",e.fr),Object.keys(e.brandSafety).forEach((n=>{o=t(o,n,e.brandSafety[n])})),o},getIASSlotTargetingAsQueryString:()=>{const o={};return Object.keys(e.slots).forEach((n=>{const a=e.slots[n];let s="";Object.keys(a).forEach((e=>{const i=a[e];if(Array.isArray(i)){s=s.concat("%26",e,"%3D");const t=i.length-1;for(let e=0,o=i.length;e<o;e+=1){let o="%2C";e===t&&(o=""),s=s.concat(i[e],o)}}else s=t(s,e,i);o[n]=s}))})),o},getAdSlotDataObj:()=>e}})();n("loader");window.dotcom=window.dotcom||{},window.dotcom.loader=window.dotcom.loader||{loading:[],loaded:[],failed:[],waiting:[]};const D=n("ias"),P=e=>{const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)}));return new Promise(((o,n)=>{if(a="ias",!window.dotcom.loader.loaded.includes(a))return void n(new Error("IAS is not enabled"));var a;const s=setTimeout((()=>{const e="getIasCustParams timeout";D(e),n(new Error(e))}),2e3),i=[{adSlotId:t,size:[1,1],adUnitPath:e,type:"video"}];window.__iasPET.queue.push({adSlots:i,dataHandler:function(e){clearTimeout(s),N.parseIASResponseData(e);const n=N.getIASPageTargetingAsQueryString(),a=N.getIASSlotTargetingAsQueryString(),i=n.substr(3)+a[t];D(`cust params: ${i}`),o(i)}})}))},z="ckpf_ppid";const M=[[0,320],[319,400],[399,600],[599,1008],[1007,1280],[1279,99999]];let G=JSON.parse(JSON.stringify([[0,320],[319,400],[399,600],[599,900],[899,1280],[1279,99999]]));G.pop(),G[4][1]=99999;const F=()=>"reel"===_().channel||I()||T(),L=()=>window.innerWidth<900,X=n("preroll"),B={sz:"640x360",iu:"",env:"vp",gdfp_req:"1",impl:"s",output:"xml_vast3",unviewed_position_start:"1",ord:"",ad_rule:"1",ppid:"",ad_type:"audio_video",cust_params:{channel:"",sectn:"",domain:"www.bbc.com",story_id:"",ctype:"content",asset_type:"story",referrer:"",referrer_domain:"",gs_cat:"",group:""}},V=e=>Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&"),J=async()=>{const e={...B};e.cust_params={...B.cust_params};const{adCampaign:o,topics:n,adUnit:a}=_();a||(window.dotcom.data.adUnit=A(window.top.location.href,L()));const i=y("uid"),r=C,c=R();if(e.iu=window.dotcom.data.adUnit,e.ord=Math.floor(1e9*Math.random()),e.ppid=s(z),e.cust_params.gs_cat=void 0!==window.gs_channels&&"DEFAULT"!==window.gs_channels?`${encodeURIComponent(window.gs_channels)}`:"",e.cust_params.group=(()=>{const e=window.innerWidth;let t="0";for(let o=0;o<M.length;o+=1){const n=M[o];e>n[0]&&e<n[1]&&(t=o.toString())}return t})(),""!==i&&(e.cust_params.uid=i),r.length&&(e.cust_params.excl_cat=r.join(",")),o&&(e.cust_params.keyword=o),n?.length){const t=n.map((e=>e.replace(/\s+/g,"-"))).join(",");e.cust_params.topics=encodeURIComponent(t)}c&&(e.cust_params.permutive=c),await(e=>{let t=0;return F()&&(t=I()?200:15),new Promise((o=>{setTimeout((()=>{const{keyValues:t}=_();Object.keys(t).forEach((o=>{e.cust_params[o]=t[o]})),o("resolved")}),t)}))})(e),""===e.cust_params.story_id&&(e.cust_params.asset_type="index",e.cust_params.ctype="index");try{const t=await P(a);e.cust_params.ias=t}catch(e){X(e.message,t)}return e.cust_params=encodeURIComponent(V(e.cust_params)),e};window.dotcom.ads.adTag=async()=>{let e="https://pubads.g.doubleclick.net/gampad/ads?";const t=await J();return e=`${e}${V(t)}`,void 0===window.dotcom.gdprApplies&&(1===window.dotcom.consent||window.dotcom.userinfo.eea)&&(e=`${e}&rdp=1&npa=1`),e}}();