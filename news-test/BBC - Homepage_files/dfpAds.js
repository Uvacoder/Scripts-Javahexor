AdsPlugin=function(){function t(){De("ad-request"),Le=!1,x.style.display="block",mt(),Et(B),L.datastore.set({name:"adsPlaying",data:!0});var e=new google.ima.AdsRequest;e.adTagUrl=T,e.linearAdSlotWidth=U.clientWidth,e.linearAdSlotHeight=U.clientHeight,e.nonLinearAdSlotWidth=U.clientWidth,e.nonLinearAdSlotHeight=U.clientHeight,e.omidAccessModeRules={},e.omidAccessModeRules[google.ima.OmidAccessMode.FULL]=[new RegExp("^doubleverify\\.com/.*$"),new RegExp("^Integralads\\.com/.*$"),new RegExp("^adsafeprotected\\.com/.*$"),new RegExp("^moat\\.com/.*$")],ne.requestAds(e),L.dispatchEvent({type:Ce,id:ke}),Ee=!0}function n(e){De("ad-manager-loaded"),L.dispatchEvent({type:Ce,id:_e});var t=new google.ima.AdsRenderingSettings;t.disableUi=!0,t.uiElements=[],t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.useStyledLinearAds=!0,(ie=e.getAdsManager(C,t)).addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,dt),ie.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,st),ie.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,rt),ie.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,lt),ie.addEventListener(google.ima.AdEvent.Type.LOADED,tt),ie.addEventListener(google.ima.AdEvent.Type.COMPLETE,ot),ie.addEventListener(google.ima.AdEvent.Type.STARTED,it),ie.addEventListener(google.ima.AdEvent.Type.CLICK,ct),ie.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,nt),ie.addEventListener(google.ima.AdEvent.Type.IMPRESSION,at),ie.addEventListener(google.ima.AdEvent.Type.LOG,et),ie.addEventListener(google.ima.AdEvent.Type.PAUSED,Xe),ie.addEventListener(google.ima.AdEvent.Type.RESUMED,Je),ie.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,Ze),ie.addEventListener(google.ima.AdEvent.Type.MIDPOINT,Ze),ie.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,Ze),ie.addEventListener(google.ima.AdEvent.Type.COMPLETE,Ze),we&&ze()}function i(e,t,n){return(e=document.createElement(e)).id=t,n.appendChild(e),e}function a(e,t,n,i,a,o,d){var s=document.createElement("button");return s.id=e,s.className=t,s.title=n,(t=document.createElement("span")).className="ads_hiddenElement",t.innerHTML=n,t.setAttribute("aria-hidden","true"),s.appendChild(t),(t=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("width",i),t.setAttribute("height",a),t.setAttribute("viewBox",o),(o=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+d),t.appendChild(o),s.appendChild(t),s}function o(){De("ad-create-ux"),D=i("div","ads_adsUX",L.container),d(D,"mouseenter focus",p),d(D,"mouseleave blur",m),U=i("div","ads_adContainer",D),(x=i("div","ads_customUI",D)).style.display="none",function(){var e=62;(B=document.createElement("div")).id="ads_spinner",B.style.width=e+"px",B.style.height=e+"px",B.style.marginLeft=-(e/2)+"px",B.style.marginTop=-(e/2)+"px",B.style.top="50%",B.style.left="50%",B.style.display="none";var t=document.createElement("canvas"),n=new Sonic(t);n.width=50,n.height=50,n.colour=I,n.thickness=10,n.draw(),B.appendChild(t),x.appendChild(B)}(),(J=i("div","ads_controlsContainer",x)).className="fadedOut",Z=i("div","ads_bottomFade",J),X=i("div","ads_bottomMiniFade",J),ee=i("div","ads_clickDiv",x),d(ee,"touchend click mouseup",g),yt(ee),H=i("div","ads_seekBar",J),(F=i("div","ads_progressBar",H)).style.backgroundColor=I;var e=i("div","ads_buttonBar",J);V=a("ads_playPauseButton","ads_pauseButton","Pause","31","31","0 0 44 44","pause"),d(V,"touchend click mouseup",bt),d(V,"mouseenter focus",s),d(V,"mouseleave blur",l),e.appendChild(V),W=a("ads_volumeButton","ads_audioButton","Mute","44","44","0 0 44 44","audio"),d(W,"touchend click mouseup",y),d(W,"mouseenter focus",s),d(W,"mouseleave blur",l),e.appendChild(W),j=a("ads_fullScreenButton","ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),d(j,"touchend click mouseup",v),d(j,"mouseenter focus",s),d(j,"mouseleave blur",l),e.appendChild(j),$=i("div","ads_skipContainer",x),Q=i("button","ads_skipButton",$),i("div","ads_skipButtonText",Q).innerHTML+="Skip Ad",i("div","ads_skipButtonIcon",Q),d(Q,"touchend click mouseup",c),d(Q,"mouseenter focus",r),d(Q,"mouseleave blur",u),q=i("div","",$),(K=i("div","ads_skipText",q)).innerHTML+="Skip ad in ",de&&(Y=i("div","ads_learnmore",x),d(Y,"touchend click mouseup",E),Y.innerHTML+="Learn More",yt(Y)),G=i("div","ads_countdownText",x),yt(G);var t=i("span","",G);re=L.settings.ui.locale.lang,e=Oe[re=(e={"en-GB":"en","en-gb":"en","cy-GB":"cy","cy-gb":"cy","gd-GB":"gd","gd-gb":"gd","ga-GB":"ga","ga-gb":"ga","ru-uk":"ru",zh:"zh-hans"})[re]?e[re]:re]||Oe.en,t.innerHTML=e+" ",(z=i("span","",G)).innerHTML="0:00",De("ad-create-ux-complete")}function d(e,t,n,i){for(var a="object"==typeof t?t:t.split(/\s+/g),o=0;o<a.length;o++)e.addEventListener(a[o],n,i)}function s(e){this.style.backgroundColor=I,this.style.fill=M}function l(e){this.style.backgroundColor="",this.style.fill=""}function r(e){this.style.border="1px solid rgba(255,255,255,1)",this.style.borderRight="0"}function u(e){this.style.border="1px solid rgba(255,255,255,0.5)",this.style.borderRight="0"}function c(e){e.stopPropagation(),ue<=0&&ie.skip()}function g(e){Te||(Te=!0,N=setTimeout(function(){Te=!1},500),de?("fadedOut"===J.className?Lt:Tt)():(ye||bt(),ie.clicked()))}function p(e){!de&&Ne&&Lt()}function m(e){!de&&Ne&&Tt()}function E(e){Te||(Te=!0,N=setTimeout(function(){Te=!1},500),ie.clicked())}function y(){Te||(Te=!0,N=setTimeout(function(){Te=!1},500),ve?(gt(W,"ads_muteButton","Mute","44","44","0 0 44 44","audio"),ie.setVolume(1)):(gt(W,"ads_unmuteButton","UnMute","44","44","0 0 44 44","mute"),ie.setVolume(0)),ve=!ve)}function v(){Te||(Te=!0,N=setTimeout(function(){Te=!1},500),L.toggleFullscreen())}function f(){A(),De("ad-sdk-loaded"),google.ima.settings.setFeatureFlags({enableOmidBeta:!0}),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(re),C=L.requestVideoElement(!0),te=window.Device&&Device.iPhoneOutOfPagePlayback?new google.ima.AdDisplayContainer(U):(google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),new google.ima.AdDisplayContainer(U,C)),(ne=new google.ima.AdsLoader(te)).addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,n),ne.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,rt),L.listenerObject={playlistLoading:Fe,playlistLoaded:We,userPlay:je,playing:Ge,ended:Qe,resize:$e,fullscreenEnter:Ue,fullscreenExit:He,error:Ve,"bbc.smp.plugins.ads.event.updateAdTag":Ke,"bbc.smp.plugins.preview.complete":Be,pluginLoaded:xe};var e=L.playlist;e&&We({playlist:e}),L.addContextMenuItem("AdsPluginHTML","AdsPluginHTML.5.5.0")}function A(){clearTimeout(S),L.updateUiConfig({cta:{enabled:!0}})}function h(){for(var e=0;e<le.length;e++)"PreviewPluginHTML"===le[e].id&&(be=!0)}var L,T,b,I,M,S,N,w,C,k,_,P,R,O,D,x,B,U,H,F,V,W,j,G,z,Q,$,q,K,Y,Z,X,J,ee,te,ne,ie,e=/windows phone/i.test(navigator.userAgent),ae=/iPhone/i.test(navigator.userAgent)&&!e,oe=/iPod/i.test(navigator.userAgent)&&!e,de=!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)),se=!1,le=[],re="en",ue=Number.POSITIVE_INFINITY,ce=function(){},ge=!1,pe=!1,me=!1,Ee=!1,ye=!1,ve=!1,fe=!1,Ae=!1,he=!1,Le=!0,Te=!1,be=!1,Ie=!1,Me=!1,Se=!1,Ne=!1,we=!1,Ce="adsPlugin",ke="adRequest",_e="adManagerLoaded",Pe="adError",Re="adDuration",Oe={en:"ADVERTISEMENT",pl:"REKLAMA",da:"REKLAME",nl:"ADVERTENTIE",fi:"MAINOS",fr:"RÉCLAME",de:"ANKÜNDIGUNG",id:"ADPERTENSI",it:"INSERZIONE",ja:"広告",nn:"ANNONSE",pt:"PROPAGANDA",es:"RECLAMO",sw:"TANGAZO",sv:"REKLAM"},De=function(e){window.performance&&performance.mark&&performance.mark(e)},xe=function(e){-1===e.url.indexOf("dfpAds")&&(le=L.datastore.get("plugins").slice()),h()},Be=function(e){(Ie=!0)!==k.hasAds&&!0!==se||(ge=!0,Ye())},Ue=function(e){he=!0,gt(j,"ads_exitFullScreenButton","Exit Full Screen","22","22","0 0 32 32","fullscreen-return"),w=setTimeout(qe,510)},He=function(e){he=!1,gt(j,"ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),w=setTimeout(qe,510)},Fe=function(e){ut(!0),k=null,Te=Se=Me=Ie=Ae=fe=ve=ye=Ee=me=pe=ge=!1,ue=Number.POSITIVE_INFINITY,Ne=!1,clearInterval(P),clearInterval(R),clearInterval(N)},Ve=function(e){"critical"==e.severity&&Fe()},We=function(e){k||!0!==(k=e.playlist).hasAds&&!0!==se||(ge=!0,Ye())},je=function(e){!0===ge&&!1===Ee&&(De("ad-container-init"),te.initialize(),t())},Ge=function(e){we=!0,ge&&(Ee?!me&&ie&&ze():(te.initialize(),t()))},ze=function(){me=!0;try{ie.init(U.clientWidth,U.clientHeight,google.ima.ViewMode.NORMAL),ie.start()}catch(e){ut()}},Qe=function(e){(Ae=!0)===ge&&!1===fe?(Le=!1,mt(),Et(B),ne.contentComplete()):(ae||oe)&&C.webkitExitFullScreen()},$e=function(e){qe()},qe=function(){ie&&ie.resize(U.clientWidth,U.clientHeight,he?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},Ke=function(e){T=e.data.adTag},Ye=function(){be&&!Ie||(L.pauseAt([0]),pe||(pe=!0,ce()))},Ze=function(e){L.dispatchEvent({type:Ce,id:"adProgress",progress:e.type})},Xe=function(e){gt(V,"ads_playButton","Play","31","31","0 0 44 44","play"),clearInterval(P),clearInterval(R),ye=!0},Je=function(e){!0===ye&&(gt(V,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),P=setInterval(At,250),O.isSkippable&&0<ue&&Ne&&(R=setInterval(ft,250)),ye=!1)},et=function(e){e=e.getAdData();e&&e.adError&&("1009"===(e=e.adError).getErrorCode()&&De("ad-empty"),L.dispatchEvent({type:Ce,id:Pe,code:e.getErrorCode(),msg:e.getMessage()}))},tt=function(e){De("ad-loaded");var t=e.getAd();_=parseInt(t.getDuration()),L.dispatchEvent({type:Ce,id:Re,duration:_});e=e.getAdData(),e={adId:e.adWrapperIds[0]||e.adId||"NULL",adQueryId:e.adQueryId,adSystem:e.adSystem,creativeId:e.adWrapperCreativeIds[0]||e.creativeId||"NULL",duration:e.duration,mediaUrl:e.mediaUrl,title:e.title};L.dispatchEvent({type:Ce,id:"adData",info:e})},nt=function(e){0<e.getAd().getDuration()&&(_=parseInt(e.getAd().getDuration()),L.dispatchEvent({type:Ce,id:Re,duration:_}))},it=function(e){De("ad-started"),!0===(O=e.getAd()).isUiDisabled()?(Ne=!0,Et(ee),J.style.bottom="",J.style.setProperty("height","calc(100% - 16px)"),de&&Et(Y),ie.resize(U.clientWidth,U.clientHeight,he?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),U.style.left="0px",U.style.top="0px",Et(H)):(Ne=!1,J.style.height="100%",yt(Y),yt(ee),U.clientWidth<600?(ie.resize(U.clientWidth-48,U.clientHeight-27,he?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),U.style.left="24px"):(ie.resize(U.clientWidth-131,U.clientHeight-74,he?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),U.style.left="66px",Lt()),U.style.top="27px",yt(H)),Et(G),function(){if(J){J.style.display="block";Z.style.display="block";X.style.display="block"}}(),Ne||(yt(Z),yt(X)),Se=!1,L.dispatchEvent({type:Ce,id:"adStarted"}),yt(B),-1==V.className.indexOf("ads_pauseButton")&&gt(V,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),At(),P=setInterval(At,250),O.isSkippable()&&Ne?($.style.display="block",q.style.display="block",Q.style.display="none",R=setInterval(ft,250)):($.style.display="none",q.style.display="none",Q.style.display="none")},at=function(e){L.dispatchEvent({type:Ce,id:"adImpression"})},ot=function(e){De("ad-complete"),L.datastore.set({name:"adsPlaying",data:!1}),L.dispatchEvent({type:Ce,id:"adEnded"}),ut()},dt=function(e){Se||ut()},st=function(){!1===L.paused&&L.pause()},lt=function(e){De("ad-all-complete"),Se||(Le||ut(),ie&&(De("ad-manager-destroy"),ie.destroy()),fe=!0,L.datastore.set({name:"adsPlaying",data:!1}),L.dispatchEvent({type:"bbc.smp.plugins.ads.event.AdsPluginExternalEvent.ALL_ADS_COMPLETED"}))},rt=function(e){De("ad-error");var t=e.getError(),n=t.getErrorCode(),i=t.getInnerError(),e=0;i&&i.getErrorCode&&(e=i.getErrorCode()),L.dispatchEvent({type:Ce,id:Pe,code:t.getErrorCode(),msg:t.getMessage()}),n===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED||e===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED?(Se=!0,ut(),L.stop(),Ee=!(ge=!0),Ye()):(ut(),lt())},ut=function(e){Le||(yt(B),Tt(),vt(),pt(),yt(G),clearInterval(P),clearInterval(R),L.pauseAt([]),e?ie&&(De("ad-manager-destroy2"),ie.destroy()):Ae||L.play(!0),Le=!0)},ct=function(){L.dispatchEvent({type:Ce,id:"adClick"}),ye||bt()},gt=function(e,t,n,i,a,o,d){e.className=t,e.title=n;t=e.getElementsByClassName("ads_hiddenElement")[0];t&&(t.innerHTML=n);n=e.getElementsByTagName("svg")[0];n.setAttribute("width",i),n.setAttribute("height",a),n.setAttribute("viewBox",o);e=e.getElementsByTagName("use")[0];e&&e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+d)},pt=function(){D&&(D.style.display="none",x.style.display="none"),L.updateUiConfig({controls:{enabled:!0},cta:{enabled:!0}})},mt=function(){L.updateUiConfig({controls:{enabled:!1},cta:{enabled:!1}}),D&&(D.style.display="block",qe())},Et=function(e){e&&(e.style.display="block")},yt=function(e){e&&(e.style.display="none")},vt=function(){J&&(J.style.display="none",Z.style.display="none",X.style.display="none")},ft=function(){var e=O.getDuration()-ie.getRemainingTime();0<(ue=Math.ceil(O.getSkipTimeOffset()-e))?K.innerText="Skip ad in "+ue:(Q.style.display="block",q.style.display="none",clearInterval(R))},At=function(){var e=ie.getRemainingTime();Me||_<e&&(_=e,Me=!0);var t=(_-e)/_;z.innerHTML=ht(e),H.clientWidth<50||isNaN(t)||(F.style.width=100*t+"%")},ht=function(e){(e=Math.round(e))<0&&(e=0);var t=Math.floor(e/60%60),e=Math.floor(e%60);return[t,e=e<10?"0"+e:e].join(":")},Lt=function(){J.className="fadedIn",V.style.pointerEvents="auto",j.style.pointerEvents="auto",Q.style.pointerEvents="auto",W.style.pointerEvents="auto"},Tt=function(){J.className="fadedOut",V.style.pointerEvents="none",j.style.pointerEvents="none",Q.style.pointerEvents="none",W.style.pointerEvents="none"},bt=function(e){Te||(Te=!0,N=setTimeout(function(){Te=!1},500),ye?(gt(V,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),ie.resume(),P=setInterval(At,250),O.isSkippable&&0<ue&&Ne&&(R=setInterval(ft,250))):(gt(V,"ads_playButton","Play","31","31","0 0 44 44","play"),ie.pause(),clearInterval(P),clearInterval(R)),ye=!ye)};return{pluginInitialisation:function(e){var t;De("ad-plugin-init"),L=e.playerInterface,i={id:"dfpAds",version:"5.5.0"},t=L.datastore.get("plugins"),le=t?((t=t.slice()).push(i),t):[i],L.datastore.set({name:"plugins",data:le.slice()}),h(),L.listenerObject={pluginLoaded:xe};var n,i=(i=L.datastore.get("AdsPluginParameters"))||{};L.updateUiConfig({cta:{enabled:!1}}),e.loadCSS(i.cssPath||"../css/dfpAds.css"),se=!!i.pretendPlaylistHasAds,T=i.adTag,b=!!i.debug,I=L.settings.ui.colour,M=L.settings.ui.foreColour,ce="function"==typeof i.setupCompanionAds?i.setupCompanionAds:function(){},o(),S=setTimeout(function(){A()},5e3),n=f,De("ad-sdk-load"),window.google&&window.google.ima?n():((i=document.createElement("script")).async=!0,i.type="text/javascript",i.onload=function(){n()},i.src=document.location.protocol+(!0==b?"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js":"//imasdk.googleapis.com/js/sdkloader/ima3.js"),document.getElementsByTagName("head")[0].appendChild(i))},reset:function(){clearTimeout(N),clearTimeout(w),clearTimeout(S),Fe()}}}();var runPlugin=function(e,t){return e.register({name:"dfpAds.js"}),AdsPlugin};